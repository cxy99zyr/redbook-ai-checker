export const PARAM_CATEGORIES = {
  画质: ["画质", "画质芯片", "屏幕", "反射率", "刷新率", "背光分区", "峰值亮度", "色域"],
  音质: ["音响品牌", "声道", "前出音"],
  智能: ["遥控器", "运行内存", "Wi-Fi模块", "HDMI数量"],
  其他: ["机身厚度（约）", "安装方式"],
} as const

export const ALL_PARAMS = Object.values(PARAM_CATEGORIES).flat()

export const CATEGORY_STYLE: Record<string, string> = {
  画质: "param-tag-picture",
  音质: "param-tag-sound",
  智能: "param-tag-smart",
  其他: "param-tag-other",
}

export function getCategoryForParam(param: string): string {
  for (const [category, params] of Object.entries(PARAM_CATEGORIES)) {
    if ((params as readonly string[]).includes(param)) return category
  }
  return "其他"
}

export const PARSE_PROMPT = `你是电视参数提取助手。
请从下面文本中，只提取以下参数，没有则留空，不要新增参数。

参数列表：
画质、画质芯片、屏幕、反射率、刷新率、背光分区、峰值亮度、色域、音响品牌、声道、前出音、遥控器、运行内存、Wi-Fi模块、HDMI数量、机身厚度（约）、安装方式

只输出JSON格式，不要其他文字：
{
  "画质": "",
  "画质芯片": "",
  "屏幕": "",
  "反射率": "",
  "刷新率": "",
  "背光分区": "",
  "峰值亮度": "",
  "色域": "",
  "音响品牌": "",
  "声道": "",
  "前出音": "",
  "遥控器": "",
  "运行内存": "",
  "Wi-Fi模块": "",
  "HDMI数量": "",
  "机身厚度（约）": "",
  "安装方式": ""
}

待提取文本：
`

export const VERIFY_PROMPT = `你是小红书电视文案参数校核专家。
任务：只校核参数对错，不润色、不改风格、不增内容。

【标准参数】：
{{PARAMS}}

【待校核文案】
标题：{{TITLE}}
正文：{{CONTENT}}

【规则】
1. 只校核上面参数中的项目，**文案中没出现的参数不校验**。
2. 只判断：正确 / 错误。
3. 错误要标出：位置(标题/正文)、参数项、错误值、正确值。
4. 修正文案：**只替换错误参数，完全保留原句、语气、风格**。
5. 如果文案中所有出现的参数都正确，has_error为false，error_list为空数组。

输出JSON格式，不要多余内容：
{
  "has_error": true或false,
  "error_list": [
    {
      "position": "标题或正文",
      "param": "参数名",
      "wrong_value": "文案里的值",
      "correct_value": "标准值"
    }
  ],
  "corrected_title": "修正后标题，只改参数",
  "corrected_content": "修正后正文，只改参数"
}`

/* ─── 文案润色功能 ─── */

export const POLISH_DIRECTIONS = [
  { key: "usage_feedback", label: "使用反馈", description: "真实体验向，强调使用感受" },
  { key: "ask_interact", label: "询问互动", description: "以提问引发评论，提升互动率" },
  { key: "shopping_unbox", label: "购物晒单", description: "开箱/收货场景，突出性价比" },
  { key: "promo_activity", label: "福利活动", description: "突出优惠/赠品/限时活动" },
  { key: "safe_choice", label: "安全下车", description: "强调避坑、靠谱、品质保障" },
  { key: "after_sales", label: "售后保障", description: "突出售后政策、服务优势" },
  { key: "eye_catching", label: "噱头吸睛", description: "用夸张/反差表达抓眼球，不夸大参数" },
  { key: "trending", label: "热点结合", description: "贴合当下热点话题，植入产品" },
] as const

export type PolishDirectionKey = typeof POLISH_DIRECTIONS[number]["key"]

export function getDirectionByKey(key: string) {
  return POLISH_DIRECTIONS.find((d) => d.key === key)
}

/* ─── 结构化写作模板系统 ─── */

export interface StructuredTemplate {
  key: PolishDirectionKey
  structure: string[]  // 结构模块名称
  structureDesc: string[]  // 每个模块的详细说明
  example: string  // 正确示例
}

export const STRUCTURED_TEMPLATES: Record<PolishDirectionKey, StructuredTemplate> = {
  usage_feedback: {
    key: "usage_feedback",
    structure: ["场景引入", "痛点共鸣", "产品优势", "使用建议", "总结推荐"],
    structureDesc: [
      "用第一人称描述具体使用场景（客厅/卧室/装修新家等），带入画面感",
      "提出用户可能遇到的痛点或担忧（画质不清晰、音质差、操作复杂等）",
      "自然引出产品如何解决这些痛点，把参数融入体验描述中",
      "分享1-2条真实使用心得或小技巧",
      "给出购买/使用建议，呼吁互动"
    ],
    example: `【正确示例】
标题：住了3个月才敢说！这台电视真的绝了
正文：
🏠 新家装修完搬进来快3个月了，每天下班回家第一件事就是窝沙发看电视~

之前一直纠结要不要买贵的，怕花冤枉钱。后来想想客厅是全家待最久的地方，画质音质差了天天看着糟心...

现在这台真的没让我失望！4K画质看球赛太爽了，120Hz刷新率完全不拖影。最惊喜的是音响效果，2.0声道看电影有种小影院的感觉，低音浑厚不闷~

💡 分享个小技巧：记得把图像模式调成"电影"，色彩更自然！

家里有装修计划的姐妹可以考虑，客厅大件真的别省，天天用的东西体验感太重要了！你们客厅电视是多少寸的呀？`
  },
  ask_interact: {
    key: "ask_interact",
    structure: ["疑问开场", "场景描述", "产品体验", "观点分享", "提问收尾"],
    structureDesc: [
      "用疑问句或争议话题开场，引发好奇心",
      "描述一个具体使用场景，让读者代入",
      "分享产品体验，把参数融入真实感受中",
      "给出自己的观点或建议",
      "以开放式问题收尾，邀请评论互动"
    ],
    example: `【正确示例】
标题：说实话，电视真的有必要买贵的吗？
正文：
💭 评论区吵翻了！有人说3000就够用，有人说上万才叫享受...

我是这样想的：要看你怎么用——

如果只是偶尔看看新闻，确实不用太好。但如果像我一样，周末喜欢在家看电影、打游戏，那画质和刷新率真的有差别！

我这台120Hz刷新率玩游戏丝滑流畅，4K画质看大片细节拉满。VA软屏色彩浓郁，看动作片特别带感~

而且现在很多国产旗舰性价比真的高，72%色域+350nit亮度，不输大牌。

所以姐妹们，你们买电视最看重啥？画质还是价格？评论区聊聊👇`
  },
  shopping_unbox: {
    key: "shopping_unbox",
    structure: ["开箱场景", "选购对比", "核心卖点", "价格优势", "购买建议"],
    structureDesc: [
      "描述收到快递、拆箱的真实场景，带入仪式感",
      "简述选购过程中对比了哪些选项，为什么选这款",
      "重点展示产品核心卖点，参数融入开箱体验中",
      "强调性价比、优惠力度、赠品等",
      "给出购买渠道建议，呼吁互动"
    ],
    example: `【正确示例】
标题：开箱！蹲了2个月终于到手了
正文：
📦 快递小哥抬上来的时候我就激动了，这个箱子也太大了！！

之前对比了小米、海信、TCL好几款，纠结了快2个月...最后选这台主要是：
1️⃣ 4K画质+120Hz刷新率，这个价位配置真的顶
2️⃣ MT9618芯片据说是这个档位最好的
3️⃣ 评论区口碑不错，差评很少

开机一看，画面确实清晰！色域72% NTSC，颜色很正，不是那种假艳的感觉。

💰 活动价入的，比日常便宜了大几百，还送了挂架和延保~

有姐妹想入的话建议多蹲蹲活动价，日常原价不太划算。你们都是什么价入的？`
  },
  promo_activity: {
    key: "promo_activity",
    structure: ["活动预告", "产品亮点", "优惠详情", "购买攻略", "限时提醒"],
    structureDesc: [
      "用紧迫感开场，提示活动时间或限量信息",
      "快速介绍产品核心卖点，参数融入利益点描述",
      "详细列出优惠内容：满减、赠品、叠加券等",
      "给出最优购买策略或渠道建议",
      "再次强调时效性，呼吁行动"
    ],
    example: `【正确示例】
标题：冲！全年最低价就这几天
正文：
🔥 姐妹们！！这波活动力度真的炸了！！

我盯了2个月的这款电视终于降价了——
✅ 4K超高清+120Hz高刷，看电影打游戏都绝
✅ MT9618画质芯片，色彩细节拉满
✅ 2.0声道双扬声器，不用另配音箱

💰 优惠叠加攻略：
1️⃣ 活动直降300
2️⃣ 叠加店铺券再减100
3️⃣ 晒单返50元猫超卡
算下来比双11还便宜！还送挂架和3年延保~

⏰ 活动就到明天24点！库存已经不多了，刚才看又少了几台...
要入的姐妹赶紧冲，错过真的要等半年！`
  },
  safe_choice: {
    key: "safe_choice",
    structure: ["踩坑回忆", "避坑要点", "本品安心点", "品质承诺", "避坑指南"],
    structureDesc: [
      "描述过去踩坑或差点踩坑的经历，引发共鸣",
      "总结选购时需要注意的坑点",
      "详细说明这款产品为什么让人放心，参数融入品质说明",
      "强调品牌保障、售后政策、质检标准等",
      "给出3条具体的避坑建议"
    ],
    example: `【正确示例】
标题：被坑过一次后，我总结的电视避坑指南
正文：
😭 之前贪便宜买的那台，用了半年屏幕就出问题了，售后还扯皮...从此学乖了！

这次买新电视，我重点看了这几个：
❌ 不要杂牌（售后没保障）
❌ 不要软屏标硬屏的（容易踩坑）
❌ 不要虚标参数的（看评论区避雷）

这台买之前做了很多功课——
✅ 大厂出品，售后网点多
✅ VA软屏，参数写得明明白白
✅ 4K画质+120Hz刷新率，实打实的配置
✅ MT9618芯片在这个价位是顶配了

最关键的是3年质保，有问题直接上门换新，买得安心~

💡 给姐妹们的避坑建议：
1. 一定看清屏幕类型，VA软屏和IPS各有优缺点
2. 刷新率低于60Hz的别买，看视频会拖影
3. 售后政策要问清楚，最好选上门服务的`
  },
  after_sales: {
    key: "after_sales",
    structure: ["问题场景", "售后体验", "服务亮点", "政策说明", "购买建议"],
    structureDesc: [
      "描述遇到的问题或担忧的场景",
      "详细记录售后处理过程，体现服务质量",
      "强调售后服务的亮点：响应速度、态度、解决方案等",
      "说明具体的售后政策：保修期、上门服务、换新条件等",
      "给出针对售后方面的购买建议"
    ],
    example: `【正确示例】
标题：说说我的售后经历，选对品牌真的太重要了
正文：
📞 上周电视突然黑屏，给我急坏了...

结果一打客服电话，人家说明天就上门！真的第二天师傅就来了，检查了一下是接口松了，2分钟搞定~

整个过程体验感太好了：
✅ 电话10秒接通，没有机器人绕圈
✅ 师傅上门准时，还带了鞋套
✅ 检查完主动帮我理了下线，太细心了

买的时候就冲着这个牌子售后好去的，3年质保+全国联保，有问题直接换新。

产品本身也没得说——4K画质看着舒服，120Hz刷新率打游戏流畅，2.0声道够用了。

💡 建议姐妹们买大件一定看售后：
1. 选全国联保的，别买只有店铺保的
2. 问清楚是维修还是换新
3. 保留好发票和包装，万一退换用得上`
  },
  eye_catching: {
    key: "eye_catching",
    structure: ["反差开场", "痛点放大", "产品惊喜", "体验细节", "金句收尾"],
    structureDesc: [
      "用反差、夸张或意外的表达抓眼球，制造好奇",
      "放大用户痛点或常见误区，引发共鸣",
      "反转介绍产品带来的惊喜体验",
      "用具体场景和细节描述产品优势，参数融入体验",
      "用金句或有记忆点的话收尾"
    ],
    example: `【正确示例】
标题：3000块的电视，把我2万的投影仪干趴了
正文：
🤯 我是真的没想到...

之前为了搞家庭影院，咬牙买了个2万的投影仪。结果呢？大白天拉窗帘也看不清，灯泡还贵得离谱。

后来客厅换了这台电视，直接傻眼——
- 4K画质比投影仪清晰太多了！！
- 350nit亮度白天也能看，不用当蝙蝠侠
- 2.0声道够震撼，不用另配音箱

关键才花了零头的钱...

现在那台投影仪在角落吃灰🥲 有同样纠结的姐妹，真心建议先买台好电视，投影仪真的是智商税。

人生建议：别跟风，要跟需求走！`
  },
  trending: {
    key: "trending",
    structure: ["热点引入", "话题关联", "产品植入", "体验分享", "互动引导"],
    structureDesc: [
      "从当下热点话题切入，引发兴趣",
      "自然过渡到产品使用场景，建立关联",
      "巧妙植入产品，参数融入话题讨论",
      "分享真实体验，呼应热点",
      "用热点相关的问题引导互动"
    ],
    example: `【正确示例】
标题：追完繁花，我悟了：看剧体验太重要了
正文：
📺 《繁花》终于看完了！！剧情上头，但更上头的是画面！

黄河路的霓虹灯、阿宝的西装、玲子的旗袍...每一帧都是电影级的构图。用手机看完全浪费这个画质！

后来换到电视上重刷，直接原地升华——
✨ 4K画质+72%色域，那个年代感的滤镜一下就出来了
✨ 120Hz刷新率，镜头晃动也不糊
✨ 色彩浓郁但不假，看那些老上海的场景太有味道了

怪不得胡歌说这部剧要在大屏幕上看...果然好剧配好屏才是绝配！

最近还有啥好剧推荐吗？打算趁周末刷起来🍿`
  },
}

export function getTemplateByKey(key: PolishDirectionKey): StructuredTemplate {
  return STRUCTURED_TEMPLATES[key]
}

export const INSPIRE_PROMPT = `你是小红书爆款文案创作专家。
任务：基于产品参数和原始文案，围绕指定润色方向，发散3-5条创作灵感。

【产品参数】：
{{PARAMS}}

【原始标题】：{{TITLE}}
【原始正文】：{{CONTENT}}

【润色方向】：{{DIRECTION_LABEL}} — {{DIRECTION_DESC}}

【规则】
1. 每条灵感是一句话的创作思路/角度，不是完整文案，要具体、有画面感。
2. 所有灵感必须基于真实产品参数，不得虚构/夸大参数。
3. 贴合小红书调性：口语化、有网感。
4. 不同灵感之间角度要有差异。
5. 输出3-5条灵感。

输出JSON格式，不要其他文字：
{
  "inspirations": [
    "灵感描述1",
    "灵感描述2",
    "灵感描述3"
  ]
}`

// 无参数模式：纯文案灵感发散（用于未上传产品参数时）
export const SIMPLE_INSPIRE_PROMPT = `你是小红书爆款文案创作专家。
任务：基于原始文案，围绕指定润色方向，发散3-5条创作灵感。

【原始标题】：{{TITLE}}
【原始正文】：{{CONTENT}}

【润色方向】：{{DIRECTION_LABEL}} — {{DIRECTION_DESC}}

【规则】
1. 每条灵感是一句话的创作思路/角度，不是完整文案，要具体、有画面感。
2. 贴合小红书调性：口语化、有网感。
3. 不同灵感之间角度要有差异。
4. 如果原文案包含产品参数，保持参数不变，仅提供创作角度。
5. 输出3-5条灵感。

输出JSON格式，不要其他文字：
{
  "inspirations": [
    "灵感描述1",
    "灵感描述2",
    "灵感描述3"
  ]
}`

// 无参数模式：纯文案重构（用于未上传产品参数时）
export const SIMPLE_POLISH_PROMPT = `你是小红书爆款文案创作专家。

## 核心任务
完全重构用户提供的小红书文案，提升吸引力和可读性。
⚠️ 注意：是"完全重构"而非"简单润色"——你必须重新设计结构、创造新的表达。禁止只做词句微调！

## 原始文案（仅作参考）
标题：{{TITLE}}
正文：{{CONTENT}}

## 重构规则
1. 重新设计段落结构，打乱原文顺序
2. 新增场景描述、痛点共鸣、使用体验
3. 语言口语化、有网感，符合小红书调性
4. 适当使用emoji（适度），增加可读性
5. 如果原文包含产品参数，必须保持参数准确，但要自然融入体验描述

## 正反面示例

### ❌ 错误示例
原文：这款产品很好用，推荐给大家。
错误：这款产品超好用✨，强烈推荐给大家！！
问题：只改了表达和加emoji，结构完全没变

### ✅ 正确示例
原文：这款产品很好用，推荐给大家。
正确：
用了一个月才敢来说！！
之前一直犹豫要不要买，怕踩坑...
结果用下来真香！[具体使用场景描述]
姐妹们有需要的可以冲，亲测靠谱~
💡 小建议：[实用技巧]

## 结尾要求
必须包含1-3条针对用户的实用建议

## 输出格式
输出JSON格式，不要其他文字：
{
  "has_error": false,
  "error_list": [],
  "corrected_title": "重构后标题（推荐）",
  "corrected_content": "重构后正文"
}`

// 完整润色模式：需要产品参数和灵感方向 —— 结构化重构版
export const POLISH_PROMPT = `你是小红书爆款文案创作专家。

## 核心任务
基于选定的创作灵感，完全重构一篇新的小红书文案。
⚠️ 注意：是"完全重构"而非"润色优化"——你必须从头设计文案结构、重新组织内容、创造新的表达方式。禁止只做词句微调！

## 产品参数（必须100%保真）
{{PARAMS}}

## 原始文案（仅作参考，不要沿用原结构）
标题：{{TITLE}}
正文：{{CONTENT}}

## 创作方向与灵感
方向：{{DIRECTION_LABEL}} — {{DIRECTION_DESC}}
灵感：{{INSPIRATION}}

## 结构模板（必须严格遵循）
{{STRUCTURE_TEMPLATE}}

## 参数融入规则
产品参数必须自然融入"使用体验"中，禁止单独列参数表或生硬罗列规格：
✅ 正确："4K画质看球赛太爽了，120Hz刷新率完全不拖影"
✅ 正确："2.0声道看电影有种小影院的感觉"
❌ 错误："画质：4K；刷新率：120Hz；声道：2.0"
❌ 错误："这款电视配置包括4K画质、120Hz刷新率、2.0声道..."

## 正反面示例

### ❌ 错误示例（只改表面，结构不变）
原文：这款电视画质清晰，声音好听，推荐购买。
错误重构：这款电视画质超清晰✨，声音超好听🎵，强烈推荐购买！！
问题：只改了标点和emoji，结构完全一样，这是偷懒！

### ✅ 正确示例（完全重构）
原文：这款电视画质清晰，声音好听，推荐购买。
正确重构：
🏠 新家装修完3个月了，每天窝沙发看电视成了最享受的事~
之前一直担心买便宜了画质糊，买贵了钱包痛...这台真的刚刚好！
4K看球赛太爽了，老公说比去酒吧还清楚😂 120Hz刷新率打游戏丝滑，儿子都不去网吧了。
2.0声道看电影有小影院的感觉，不用另配音箱省一笔~
💡 建议：图像模式调"电影"色彩更自然！
家里有装修计划的姐妹冲它，客厅大件别省，天天用体验感太重要了！

## 结尾实用建议（必须包含）
文案结尾必须包含1-3条针对同场景用户的真实建议，如：
- 选购技巧（什么值得买/什么要避坑）
- 使用技巧（怎么设置更好用）
- 装修/搭配建议（适合什么空间）

## 输出格式
输出JSON格式，不要其他文字：
{
  "polished_titles": ["重构后标题1", "重构后标题2"],
  "polished_content": "重构后正文"
}`
